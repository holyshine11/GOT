<!-- admin_create.html -->

{% extends "admin/base_site.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/admin_create.css' %}">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const usernameInput = document.querySelector("input[name='username']");
            const form = document.querySelector("form");
    
            usernameInput.addEventListener("input", function() {
                const pattern = /^[A-Za-z0-9]{8,20}$/;
                const errorDiv = this.parentElement.querySelector(".username-error");
    
                if (!pattern.test(this.value)) {
                    if (!errorDiv) {
                        const error = document.createElement("div");
                        error.classList.add("error-message", "username-error");
                        error.textContent = "아이디는 8~20자의 영문 대소문자 및 숫자만 사용할 수 있습니다.";
                        this.parentElement.appendChild(error);
                    }
                } else {
                    if (errorDiv) {
                        errorDiv.remove();
                    }
                }
            });
    
            form.addEventListener("submit", function(event) {
                const pattern = /^[A-Za-z0-9]{8,20}$/;
                if (!pattern.test(usernameInput.value)) {
                    event.preventDefault();
                    alert("아이디는 8~20자의 영문 대소문자 및 숫자만 사용할 수 있습니다.");
                }
            });
        });
    </script>
</head>

<div class="content">
    <form method="post" action="{% url 'admin_create' %}">
        {% csrf_token %}
        <div class="header-container">
            <h1>관리자 관리</h1>
        </div>
        <div class="header-container">
            <h2>관리자 등록</h2> <p> "*" 항목은 필수 입력항목 입니다. </p>
        </div>

        <table class="admin-table">
            <colgroup>
                <col style="width: 15%; vertical-align: middle;">
                <col style="width: 85%; vertical-align: middle;">
            </colgroup>
            <tr>
                <th>
                    {{ form.username.label }}
                    {% if form.username.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="username" value="{{ form.username.value|default_if_none:'' }}" 
                    placeholder="아이디를 입력하세요" class="form-control" {% if form.username.field.required %}required{% endif %} 
                    pattern="^[A-Za-z0-9]{8,20}$" title="아이디는 8~20자의 영문 대소문자 및 숫자만 사용할 수 있습니다.">
                    {% if form.username.errors %}
                        <div class="error-message">{{ form.username.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.email.label }}
                    {% if form.email.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="email" name="email" value="{{ form.email.value|default_if_none:'' }}" placeholder="이메일을 입력하세요" class="form-control" {% if form.email.field.required %}required{% endif %}>
                    {% if form.email.errors %}
                        <div class="error-message">{{ form.email.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.password1.label }}
                    {% if form.password1.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="password" name="password1" placeholder="비밀번호를 입력하세요" class="form-control" {% if form.password1.field.required %}required{% endif %}>
                    {% if form.password1.errors %}
                        <div class="error-message">{{ form.password1.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.password2.label }}
                    {% if form.password2.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="password" name="password2" placeholder="비밀번호를 다시 입력하세요" class="form-control" {% if form.password2.field.required %}required{% endif %}>
                    {% if form.password2.errors %}
                        <div class="error-message">{{ form.password2.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.manager_name.label }}
                    {% if form.manager_name.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="manager_name" value="{{ form.manager_name.value|default_if_none:'' }}" placeholder="담당자 이름을 입력하세요" class="form-control" {% if form.manager_name.field.required %}required{% endif %}>
                    {% if form.manager_name.errors %}
                        <div class="error-message">{{ form.manager_name.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.position.label }}
                    {% if form.position.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="position" value="{{ form.position.value|default_if_none:'' }}" placeholder="직책을 입력하세요" class="form-control" {% if form.position.field.required %}required{% endif %}>
                    {% if form.position.errors %}
                        <div class="error-message">{{ form.position.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.company.label }}
                    {% if form.company.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="company" value="{{ form.company.value|default_if_none:'' }}" placeholder="회사명을 입력하세요" class="form-control" {% if form.company.field.required %}required{% endif %}>
                    {% if form.company.errors %}
                        <div class="error-message">{{ form.company.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.department.label }}
                    {% if form.department.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="department" value="{{ form.department.value|default_if_none:'' }}" placeholder="부서를 입력하세요" class="form-control" {% if form.department.field.required %}required{% endif %}>
                    {% if form.department.errors %}
                        <div class="error-message">{{ form.department.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.company_contact.label }}
                    {% if form.company_contact.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="company_contact" value="{{ form.company_contact.value|default_if_none:'' }}" placeholder="회사 연락처를 입력하세요" class="form-control" {% if form.company_contact.field.required %}required{% endif %}>
                    {% if form.company_contact.errors %}
                        <div class="error-message">{{ form.company_contact.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.manager_contact.label }}
                    {% if form.manager_contact.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <input type="text" name="manager_contact" value="{{ form.manager_contact.value|default_if_none:'' }}" placeholder="담당자 연락처를 입력하세요" class="form-control" {% if form.manager_contact.field.required %}required{% endif %}>
                    {% if form.manager_contact.errors %}
                        <div class="error-message">{{ form.manager_contact.errors|join:" " }}</div>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.role.label }}
                    {% if form.role.field.required %}
                        <span class="required">*</span>
                    {% endif %}
                </th>
                <td>
                    <select name="role" class="form-control fixed-width-select" {% if form.role.field.required %}required{% endif %}>
                        <option value="">관리자 유형을 선택하세요</option>
                        {% for choice in form.role.field.choices %}
                            <option value="{{ choice.0 }}" {% if form.role.value == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    {% if form.role.errors %}
                        <div class="error-message">{{ form.role.errors|join:" " }}</div>
                    {% endif %}                             
                </td>
            </tr>
        </table>
        <div class="button-group">
            <button type="submit" class="btn btn-primary btn-inline">저장</button>
            <button type="button" onclick="window.location.href='{% url 'admin:admin_app_profile_changelist' %}'" class="btn btn-secondary btn-inline">취소</button>
        </div>            
    </form>
</div>
{% endblock %}
